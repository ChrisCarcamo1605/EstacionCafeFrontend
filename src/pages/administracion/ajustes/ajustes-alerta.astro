---
export const prerender = false;
import Navbar from "../../../components/Navbar.astro";
import Layout from "../../../layouts/Layout.astro";
import LeftBar from "../../../components/LeftBar.astro";

const options: string[] = ["General", "Alertas"];

// Estado inicial del correo (podrías cargarlo desde localStorage o una API)
let email = "correoparareportes@gmail.com";

// Función para guardar el correo
const saveEmail = () => {
  const emailInput = document.getElementById('email-input') as HTMLInputElement;
  if (emailInput) {
    localStorage.setItem('reportEmail', emailInput.value);
    alert('Correo guardado correctamente');
  }
};

// Función para cargar el correo guardado
const loadEmail = () => {
  const savedEmail = localStorage.getItem('reportEmail');
  if (savedEmail) {
    const emailInput = document.getElementById('email-input') as HTMLInputElement;
    if (emailInput) {
      emailInput.value = savedEmail;
    }
  }
};
---

<!-- Importar fuente Roboto -->
<link
  href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
  rel="stylesheet"
/>

<Layout>
  <Navbar />

  <div class="container-fluid d-flex m-0 p-0">
    <LeftBar title="Ajustes" options={options} />

    <div
      class="col-md-10 bg-white p-0 h-100"
      style="font-family: 'Roboto', sans-serif;"
    >
      <div class="h-100 d-flex flex-column">
        <div class="card border-0 shadow-sm h-100 rounded-3">
          <div class="card-header bg-white border-0 py-2 px-3">
            <h1 class="h3 fw-semibold mb-4">Alertas</h1>
          </div>

          <!-- Ajuste del padding izquierdo reducido -->
          <div class="card-body py-3 px-4">
            <!-- Campo de correo -->
            <div class="mb-3">
              <label class="form-label small fw-bold mb-1"
                >Correo para alertas y reportes</label
              >
              <input
                id="email-input"
                type="email"
                class="form-control form-control-sm shadow-sm border-light"
                placeholder="correo@ejemplo.com"
                style="max-width: 300px;"
                value={email}
              />
            </div>

            <!-- Campo porcentaje -->
            <div class="mb-3">
              <label class="form-label small fw-bold mb-1"
                >Porcentaje límite de inventario para alertas</label
              >
              <input
                type="text"
                class="form-control form-control-sm shadow-sm border-light"
                style="max-width: 100px;"
                value="25%"
              />
            </div>

            <!-- Campo periodo -->
            <div class="mb-3">
              <label class="form-label small fw-bold mb-1"
                >Periodo de Alertas</label
              >
              <div
                class="d-flex flex-column gap-2 mt-1"
                style="max-width: 220px;"
              >
                <span
                  class="badge bg-white border shadow-sm d-flex justify-content-between align-items-center px-3 py-2 w-100 text-dark"
                  style="font-weight: 400;"
                >
                  <span>Cada 2 días</span>
                  <button
                    type="button"
                    class="btn-close btn-close-sm"
                    aria-label="Cerrar"></button>
                </span>
                <span
                  class="badge bg-white border shadow-sm d-flex justify-content-between align-items-center px-3 py-2 w-100 text-dark"
                  style="font-weight: 400;"
                >
                  <span>Semanal</span>
                  <button
                    type="button"
                    class="btn-close btn-close-sm"
                    aria-label="Cerrar"></button>
                </span>
                <span
                  class="badge bg-white border shadow-sm d-flex justify-content-between align-items-center px-3 py-2 w-100 text-dark"
                  style="font-weight: 400;"
                >
                  <span>Cada 4 días</span>
                  <button
                    type="button"
                    class="btn-close btn-close-sm"
                    aria-label="Cerrar"></button>
                </span>
                <span
                  class="badge bg-white border shadow-sm d-flex justify-content-between align-items-center px-3 py-2 w-100 text-dark"
                  style="font-weight: 400;"
                >
                  <span>Seleccione un periodo</span>
                  <button
                    type="button"
                    class="btn-close btn-close-sm"
                    aria-label="Cerrar"></button>
                </span>
              </div>
            </div>

            <button
              onclick="saveEmail()"
              class="btn btn-sm mt-2 fw-bold shadow-sm rounded-3 px-3 py-1"
              style="background-color: #E6E6E6; border-color: #E6E6E6; color: #000; font-size: 0.8rem;"
            >
              Guardar Cambios
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Declarar el tipo en Window
  declare global {
    interface Window {
      saveEmail: () => void;
    }
  }

  // Cargar el correo cuando la página se carga
  document.addEventListener('DOMContentLoaded', function() {
    const loadEmail = () => {
      const savedEmail = localStorage.getItem('reportEmail');
      if (savedEmail) {
        const emailInput = document.getElementById('email-input') as HTMLInputElement;
        if (emailInput) {
          emailInput.value = savedEmail;
        }
      }
    };

    const saveEmail = () => {
      const emailInput = document.getElementById('email-input') as HTMLInputElement;
      if (emailInput) {
        localStorage.setItem('reportEmail', emailInput.value);
        alert('Correo guardado correctamente');
      }
    };

    // Hacer las funciones globales
    window.saveEmail = saveEmail;
    
    // Cargar email al iniciar
    loadEmail();
  });
</script>