---
export const prerender = false;

import Layout from "../layouts/Layout.astro";
import LeftBar from "../components/LeftBar.astro";
import Navbar from "../components/Navbar.astro";
import BillBar from "../components/BillBar.astro";

const options = [
  "Platos Principales",
  "Postres",
  "Caf√©",
  "Combos",
  "Servicios",
];
const details: any[] = [];
---

<div></div>
<Layout title="Realizar Pedido">
  <div class="container-fluid p-0 vh-100 overflow-hidden d-flex flex-column">
    <div class="w-100 m-0"><Navbar /></div>

    <div class="d-flex flex-row flex-grow-1">
      <LeftBar options={options} title="Pedido" />
      <div
        class="w-100 d-flex flex-wrap gap-2 p-2 overflow-auto"
        id="products_container"
      >
      </div>
      <BillBar details={details} />
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async (x) => {
      x.preventDefault();

      let prodsRes = [];
      let cardContainer = document.querySelector("#products_container");
      let billBar = document.querySelector(".bill-bar tbody");

      console.log(billBar);


      //FALTA AGREGAR FUNCIONALIDAD PARA AGREGAR ITEMS AL BILLBAR
      function addProductToBill() {
        let row = document.createElement("tr");
        row.innerHTML = `
            <tr>
            <th class="fw-normal" scope="col">
              ${x.name}
            </th>
            <th class="fw-normal" scope="col">
              ${(x.quantity = 1)}
            </th>
            <th class="fw-normal" scope="col">
              ${x.price * x.quantity}
            </th>
          </tr>`;

        billBar?.appendChild(row);
      }

      const response = await fetch("http://localhost:3484/api/products", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      });

      if (response.ok) {
        const data = await response.json();
        prodsRes = data.data;
        console.log(prodsRes);
      }

      prodsRes.forEach((x: any) => {
        const card = document.createElement("div");
        card.classList.add("prod-card");
        card.classList.add("fourth_color");
        card.classList.add("card");
        card.setAttribute("style", "width: 19rem");
        card.setAttribute("prodName", x.name);
        card.setAttribute("prodPrice", x.price);
        card.setAttribute("prodQuantity", "1");

        card.innerHTML = `
              <div class="card-body text-center align-content-center">
                <h5 class="card-title">${x.name}</h5>
              </div>
          `;
        card.addEventListener("click", async (detail) => {});
        cardContainer?.append(card);
      });

          });
  </script>
</Layout>
